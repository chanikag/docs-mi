# How to Reuse Mediation Sequencess
This example demonstrates how to reuse sequences in the Micro Integrator.

## Synapse configuration

This configuration creates two Proxy Services. The first Proxy Service (StockQuoteProxy1) uses the sequence named "proxy_1" to process incoming messages and the sequence named "out" to process outgoing responses. The second Proxy Service (StockQuoteProxy2) is set to directly forward messages that are received to the endpoint named "proxy_2_endpoint" without any mediation.

=== "Endpoint"
    ```xml
    <endpoint xmlns="http://ws.apache.org/ns/synapse" name="SimpleStockQuoteService">
        <address uri="http://localhost:9000/services/SimpleStockQuoteService"/>
    </endpoint>
    ```
=== "Sequence"
    ```xml
    <sequence name="common" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
        <call>
            <endpoint key="SimpleStockQuoteService"/>
        </call>
        <respond/>
    </sequence>
    ```
=== "Proxy Service 1"
    ```xml
    <proxy xmlns="http://ws.apache.org/ns/synapse" name="Proxy1" transports="http https">
        <target>
            <inSequence>
                <log category="INFO" level="simple">
                    <property name="name" value="proxy_1"/>
                </log>
                <sequence key="common"/>
            </inSequence>
        </target>
    </proxy>
    ```
=== "Proxy Service 2"
    ```xml
    <proxy name="Proxy2" startOnLoad="true" transports="http https" xmlns="http://ws.apache.org/ns/synapse">
        <target>
            <inSequence>
                <log category="INFO" level="simple">
                    <property name="name" value="proxy_2"/>
                </log>
                <sequence key="common"/>
            </inSequence>
        </target>
    </proxy>
    ```

## Build and run

Create the artifacts:

{!includes/build-and-run.md!}
3. Create the [proxy services]({{base_path}}/develop/creating-artifacts/creating-a-proxy-service), the [mediation sequences]({{base_path}}/develop/creating-artifacts/creating-reusable-sequences), the [local entry]({{base_path}}/develop/creating-artifacts/registry/creating-local-registry-entries), and the [endpoint]({{base_path}}/develop/creating-artifacts/creating-endpoints) with the configurations given above.
4. [Deploy the artifacts]({{base_path}}/develop/deploy-artifacts) in your Micro Integrator.

Set up the back-end service:

1. Download the [back-end service](https://github.com/wso2-docs/WSO2_EI/blob/master/Back-End-Service/axis2Server.zip).
2. Extract the downloaded zip file.
3. Open a terminal, navigate to the `axis2Server/bin/` directory inside the extracted folder.
4. Execute the following command to start the axis2server with the SimpleStockQuote back-end service:

    === "On MacOS/Linux"   
          ```bash
          sh axis2server.sh
          ```
    === "On Windows"                
          ```bash
          axis2server.bat
          ```

Download the [sample_proxy_1.wsdl file](https://github.com/wso2-docs/WSO2_EI/blob/master/samples-protocol-switching/sample_proxy_1.wsdl) and copy it to the `MI_HOME/samples/wsdl` folder (create this folder if does not already exist).

You could send a stock quote request to each of these proxy services and receive the reply generated by the actual back-end service.

- Request to StockQuoteProxy1:

    ```bash
    POST http://localhost:8290/services/StockQuoteProxy1.StockQuoteProxy1HttpSoap11Endpoint HTTP/1.1
    Content-Type: text/xml;charset=UTF-8
    SOAPAction: "urn:getQuote"

    <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://services.samples" xmlns:xsd="http://services.samples/xsd">
       <soapenv:Header/>
       <soapenv:Body>
          <ser:getQuote>
             <ser:request>
                <xsd:symbol>IBM</xsd:symbol>
             </ser:request>
          </ser:getQuote>
       </soapenv:Body>
    </soapenv:Envelope>
    ```

- Request to StockQuoteProxy2:

    ```bash
    POST http://localhost:8290/services/StockQuoteProxy2.StockQuoteProxy2HttpSoap11Endpoint HTTP/1.1
    Content-Type: text/xml;charset=UTF-8
    SOAPAction: "urn:getQuote"

    <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://services.samples" xmlns:xsd="http://services.samples/xsd">
      <soapenv:Header/>
      <soapenv:Body>
         <ser:getQuote>
            <ser:request>
               <xsd:symbol>IBM</xsd:symbol>
            </ser:request>
         </ser:getQuote>
      </soapenv:Body>
    </soapenv:Envelope>
    ```
